trigger:
- main

pool:
  name: 'webapppool'

stages:
- stage: SecurityScan
  displayName: 'OWASP Dependency Check'
  jobs:
  - job: DependencyCheck
    displayName: 'Security Scan'
    steps:
    - checkout: self

    - task: NodeTool@0
      inputs:
        versionSpec: '20.x'  # veya senin kullandığın node sürümü
      displayName: 'Use Node.js'

    - script: |
        npm ci
      displayName: 'Install dependencies'

- task: Docker@2
  displayName: 'Run OWASP Dependency-Check'
  inputs:
    command: 'run'
    container: 'owasp/dependency-check:latest'
    arguments: >
      --rm
      -v $(Build.SourcesDirectory):/src:ro
      -v $(Build.ArtifactStagingDirectory):/reports
      -v /opt/dependency-check-data:/usr/share/dependency-check/data
      owasp/dependency-check:latest
      --scan /src
      --format HTML
      --project "$(Build.Repository.Name)"
      --out /reports

    - task: PublishBuildArtifacts@1
      displayName: 'Publish HTML Report'
      inputs:
        PathtoPublish: '$(Agent.TempDirectory)/reports'
        ArtifactName: 'dependency-check-report'
