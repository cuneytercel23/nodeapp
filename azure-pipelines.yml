trigger:
- main

pool:
  name: 'webapppool'

stages:
- stage: SecurityScan
  displayName: 'OWASP Dependency Check'
  jobs:
  - job: DependencyCheck
    displayName: 'Security Scan'
    steps:
    - checkout: self

    - task: Docker@2
      displayName: 'Run OWASP Dependency-Check'
      inputs:
        command: 'run'
        container: 'owasp/dependency-check:latest'
        arguments: >
          --rm
          -v $(Build.SourcesDirectory):/src:ro
          -v $(Build.ArtifactStagingDirectory)/dependency-check:/reports
          -v $(Agent.TempDirectory)/odc-data:/usr/share/dependency-check/data
          owasp/dependency-check:latest
          --scan /src
          --format HTML
          --project "$(Build.Repository.Name)"
          --out /reports

    - task: PublishBuildArtifacts@1
      displayName: 'Publish Dependency Check Report'
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)/dependency-check'
        ArtifactName: 'dependency-check-report'
        publishLocation: 'Container'
