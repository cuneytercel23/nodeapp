trigger:
- main

pool:
  name: 'webapppool'

stages:
- stage: SecurityScan
  displayName: 'OWASP Dependency Check'
  jobs:
  - job: DependencyCheck
    displayName: 'Security Scan'
    steps:
    - checkout: self

    - task: Docker@2
      displayName: 'Run OWASP Dependency-Check'
      inputs:
        command: 'run'
        container: 'owasp/dependency-check:latest'
        arguments: >
          --rm
          -v $(Build.SourcesDirectory):/src:ro
          -v $(Agent.TempDirectory)/reports:/reports
          -v /opt/dependency-check-data:/usr/share/dependency-check/data
          owasp/dependency-check:latest
          --scan /src
          --format HTML
          --project "$(Build.Repository.Name)"
          --out /reports
